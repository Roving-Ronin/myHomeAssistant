# Refer to https://pvoutput.org/help/api_specification.html        
rest_command:
  update_pvoutput:
    url: https://pvoutput.org/service/r2/addstatus.jsp
    method: post
    content_type: "application/x-www-form-urlencoded"
    headers:
      X-Pvoutput-Apikey: !secret pvoutput_api_key
      X-Pvoutput-SystemId: !secret pvoutput_system_id
    payload: 'd={{ now().strftime("%Y%m%d") }}&t={{ now().strftime("%H:%M") }}&v1={{ (states("sensor.inverters_total_yield")|float(0)|round(0)) }}&v2={{ (states("sensor.inverters_active_power")|float(0)|round(0)) }}&v3={{ (states("sensor.house_consumption_energy")|float(0)|round(0)) }}&v4={{ (states("sensor.house_consumption_power")|float(0)|round(0)) }}&v5={{ (states("sensor.goulburn_temp")|float(0)) }}&v6={{ (states("sensor.power_meter_voltage")|float(0)|round(1)) }}&v7={{ (states("sensor.batteries_state_of_capacity")|float(0)) }}&v8={{ (states("sensor.batteries_day_charge")|float(0)*1000) }}&v9={{ (states("sensor.batteries_day_discharge")|float(0)*1000) }}&v11={{ (states("sensor.hs_grid_imported_daily_total_kwh")|float(0)) }}&v12={{ (states("sensor.hs_grid_exported_daily")|float(0)) }}&c1=1'


# Watts    payload: 'd={{ now().strftime("%Y%m%d") }}&t={{ now().strftime("%H:%M") }}&v1={{ (states("sensor.inverters_total_yield")|float(0)|round(0)) }}&v2={{ (states("sensor.inverters_active_power")|float(0)|round(0)) }}&v3={{ (states("sensor.house_consumption_energy")|float(0)|round(0)) }}&v4={{ (states("sensor.house_consumption_power")|float(0)|round(0)) }}&v5={{ (states("sensor.goulburn_temp")|float(0)) }}&v6={{ (states("sensor.power_meter_voltage")|float(0)|round(1)) }}&v7={{ (states("sensor.batteries_state_of_capacity")|float(0)) }}&v8={{ (states("sensor.batteries_day_charge")|float(0)*1000) }}&v9={{ (states("sensor.batteries_day_discharge")|float(0)*1000) }}&v11={{ (states("sensor.hs_grid_imported_daily_total_kwh")|float(0)*1000) }}&v12={{ (states("sensor.hs_grid_exported_daily")|float(0)*1000) }}&c1=1'


#   payload: 'd={{ now().strftime("%Y%m%d") }}&t={{ now().strftime("%H:%M") }}&v1={{ (states("sensor.inverters_total_yield") | float(0) | round(0)  ) }}&v2={{ (states("sensor.inverters_active_power") | float(0) | round(0)) }}&v3={{ (states("sensor.house_consumption_energy") | float(0) | round(0)) }}v4={{ (states("sensor.house_consumption_power") | float(0) | round(0)) }}&v5={{ (states("sensor.goulburn_temp") | float(0)) }}&v6={{ (states("sensor.power_meter_voltage") | float(0) | round(1)) }}&v7={{ (states("sensor.inverter_internal_temperature") | float(0)) }}&v8={{ (states("sensor.inverter_internal_temperature_2") | float(0)) }}&v9={{ (states("sensor.batteries_state_of_capacity") | float(0)) }}&v10={{ (states("sensor.battery_1_charge_discharge_power") | float(0)) }}&v11={{ (states("sensor.electricity_price") | float(0) * 100) | round(3) }}&v12={{ (states("sensor.electricity_fit") | float(0) * 100) | round(2) }}&c1=1'

# v1,2,4    payload: 'd={{ now().strftime("%Y%m%d") }}&t={{ now().strftime("%H:%M") }}&v1={{ (states("sensor.inverters_total_yield") | float(0) | round(0)) }}&v2={{ (states("sensor.inverters_active_power") | float(0) | round(0)) }}&v4={{ (states("sensor.house_consumption_power") | float(0) | round(0)) }}&v5={{ (states("sensor.goulburn_temp") | float(0)) }}&v6={{ (states("sensor.power_meter_voltage") | float(0) | round(1)) }}&v7={{ (states("sensor.inverter_internal_temperature") | float(0)) }}&v8={{ (states("sensor.inverter_internal_temperature_2") | float(0)) }}&v9={{ (states("sensor.batteries_state_of_capacity") | float(0)) }}&v10={{ (states("sensor.battery_1_charge_discharge_power") | float(0)) }}&v11={{ (states("sensor.electricity_price") | float(0)) }}&v12={{ (states("sensor.electricity_fit") | float(0)) }}&c1=1'
# Spaces 'd={{ now().strftime("%Y%m%d") }}&t={{ now().strftime("%H:%M") }}&v1={{ (states("sensor.inverters_total_yield") | float(0)) }}&v2={{ (states("sensor.inverters_active_power") | float(0)) }}&v4={{ (states("sensor.house_consumption_power") | float(0)) }}&v5={{ (states("sensor.goulburn_temp") | float(0)) }}&v6={{ (states("sensor.power_meter_voltage") | float(0) | round(1)) }}&v7={{ (states("sensor.inverter_internal_temperature") | float(0)) }}&v8={{ (states("sensor.inverter_internal_temperature_2") | float(0)) }}&v11={{ (states("sensor.electricity_price") | float(0)) }}&v12={{ (states("sensor.electricity_fit") | float(0)) }}&c1=1'
#    payload: 'd={{now().strftime("%Y%m%d")}}&t={{now().strftime("%H:%M")}}&v1={{(states('sensor.inverters_total_yield))|float(0)}}&v2={{(states('sensor.inverters_active_power'))|float(0)}}&v4={{(states('sensor.house_consumption_power'))|float(0)}}&v5={{(states('sensor.goulburn_temp'))|float(0)}}&v6={{(states('sensor.power_meter_voltage'))|float(0)|round(1)}}&v7={{(states('sensor.inverter_internal_temperature'))|float(0)}}&v8={{(states('sensor.inverter_internal_temperature_2'))|float(0)}}&v11={{(states('sensor.electricity_price'))|float(0)}}&v12={{(states('sensor.electricity_fit'))|float(0)}}&c1=1'
# WAS   payload: 'd={{now().strftime("%Y%m%d")}}&t={{now().strftime("%H:%M")}}&v1={{states.sensor.inverters_total_yield.state|float(0)*1000}}&v2={{states.sensor.inverters_input_power.state|float(0)}}&v3={{states.sensor.house_consumption_energy.state|float(0)}}&v4={{states.sensor.house_consumption_power.state|float(0)}}&v5={{states.sensor.goulburn_temp.state|float(0)}}&v6={{states.sensor.power_meter_voltage.state|float(0)|round(1)}}&v7={{states.sensor.inverter_internal_temperature.state|float(0)}}&v8={{states.sensor.inverter_internal_temperature_2.state|float(0)}}&v11={{states.states.sensor.electricity_price.state|float(0)}}&v12={{states.sensor.electricity_fit.state|float(0)}}&c1=1'
