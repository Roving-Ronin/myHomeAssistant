template:
  - sensor:
      - name: "Tariff - Water"
        unique_id: tariff_water
        state: "{{ states('counter.water_flow_meter') | float(0) * 0.5 }}"
        unit_of_measurement: "L"
        icon: mdi:water-pump
        device_class: water
        state_class: total_increasing

      - name: "Water Import Rate"
        unique_id: water_import_rate
        icon: mdi:cash-minus
        unit_of_measurement: "AUD/L"
        state: "0.00290"

      - name: "Days Passed in Year"
        unique_id: days_passed_in_year
        state: >
          {% set this = now().replace(hour=0).replace(minute=0).replace(second=0).replace(microsecond=0) %}
          {% set first = this.replace(month=1, day=1) %}
          {{ (this.date() - first.date()).days }}


# Goulburn Mulware Council - $802 p/a for sewerage connection, $2.197260273972603 per day. 
# 20mm water connection fee is $182 p.a., $0.5055555555555556 per day. If wanting water only daily fee, change this to 0.505555
      - name: "Water Supply Charge"
        unique_id: water_supply_charge
        icon: mdi:cash-minus
        unit_of_measurement: "AUD/L"
        state: "2.702815829528159"

      - name: "Water Total Cost Daily"
        unique_id: water_total_cost_daily
        icon: mdi:currency-usd
        unit_of_measurement: $
        state_class: total
        device_class: monetary
        state: >
          {% set supply = states('sensor.water_supply_charge') | float(0) %}
          {% set usage = states('sensor.water_consumption_daily') | float(0) * states('sensor.water_import_rate') | float(0) %}
          {{ (supply + usage) | round(2) }}

      - name: "Water Total Cost Monthly"
        unique_id: water_total_cost_monthly
        icon: mdi:currency-usd
        unit_of_measurement: $
        state_class: total
        device_class: monetary
        state: >
          {% set supply = states('sensor.water_supply_charge') | float(0) * now().day %}
          {% set usage = states('sensor.water_consumption_monthly') | float(0) * states('sensor.water_import_rate') | float(0) %}
          {{ (supply + usage) | round(2) }}

      - name: "Water Total Cost Yearly"
        unique_id: water_total_cost_yearly
        icon: mdi:currency-usd
        unit_of_measurement: $
        state_class: total
        device_class: monetary
        state: >
          {% set supply = states('sensor.water_supply_charge') | float(0) * ( states('sensor.days_passed_in_year') | int(0) + 1 ) %}
          {% set usage = states('sensor.water_consumption_yearly') | float(0) * states('sensor.water_import_rate') | float(0) %}
          {{ (supply + usage) | round(2) }}



utility_meter:
  water_consumption_daily:
    source: sensor.water_consumption
    name: Water Consumption - Daily
    unique_id: water_consumption_daily
    cycle: daily

  water_consumption_monthly:
    source: sensor.water_consumption
    name: Water Consumption - Monthly
    unique_id: water_consumption_monthly
    cycle: monthly

  water_consumption_yearly:
    source: sensor.water_consumption
    name: Water Consumption - Yearly
    unique_id: water_consumption_yearly
    cycle: yearly